<head>
  <title>Mat Dombrock</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8"/>
</head>
<div class="header">
  <h1><a href="/"><img src="/favicon.ico" width="25px" >Mathieu Dombrock</a></h1>
  
</div>
<small id="tagline" class="tagline" onclick="loadTagline()" style="cursor:pointer;">"Baseless claims & crimes against computing."</small>
<hr>
<div class="nav">
  <a href="/">home</a> |
  <a href="/about.html">about</a> |
  <a href="/search.html">search</a> |
  <a href="https://github.com/matdombrock" target="_blank">github</a> |
  <a href="https://replicataudio.com" target="_blank">replicataudio</a> |
  <input type="text" placeholder="local search" id="nav-search" style="float:right;">
</div>
<hr>

<script>
  document.getElementById('nav-search').addEventListener("keydown", function (e) {
      if (e.code === "Enter") {  //checks whether the pressed key is "Enter"
          search()
      }
  });

  function search(){
    window.location.href = "/search.html?s="+encodeURIComponent(document.getElementById('nav-search').value);
  }
  const quotes = [
    "Baseless claims & crimes against computing.",
    "Something should go here...",
    "This is a website.",
    "Did you see how fast this page loaded?",
    "Down with the OOP!",
    "I for one, welcome our new robot overlords.",
    "Is this thing on?",
    "Does anyone read this?",
    "Drink more water.",
    "This site, but it's John Coltrane's 'Giant Steps'.",
    "You are the "+Math.random()*10e6+"th visitor!",
    "SMASH that like button!",
    "Web 4.0",
    "Now available in color!",
    "Now available on 5G!",
    "Now available in VR!",
    "Did you notice these change every time?",
    "This site contains a secret game().",
    "Version Number: "+Math.random()*10+"."+Math.random()*10,
    "Click me!",
    "What is this? 1997?",
    "Thanks for visiting.",
    "Yet another tech blog.",
    "Yet another Warcraft 3 Map.",
    //
    "EX-TER-MIN-ATE! EX-TER-MIN-ATE!",
    "We also have a rogue robot policy.",
    "Give me an analysis, Joey.",
    "You didn't tell me you could fly!",
    "What's that ROBOT doing here?",
    
  ];
  function loadTagline(){
    document.getElementById('tagline').innerHTML = '"'+quotes[Math.floor(Math.random() * quotes.length)]+'"';
  }
  loadTagline();
  function game(input){
    console.log("This is a game (true me)");
    console.log("You said: "+input);
    if(input === 1337){
      console.log('win');
    }else{
      alert('fail');
      window.location.replace("https://youtu.be/dQw4w9WgXcQ");
    }
  }

</script><style>/*

Monokai Sublime style. Derived from Monokai by noformnocontent http://nn.mit-license.org/

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  background: #23241f;
}

.hljs,
.hljs-tag,
.hljs-subst {
  color: #f8f8f2;
}

.hljs-strong,
.hljs-emphasis {
  color: #a8a8a2;
}

.hljs-bullet,
.hljs-quote,
.hljs-number,
.hljs-regexp,
.hljs-literal,
.hljs-link {
  color: #ae81ff;
}

.hljs-code,
.hljs-title,
.hljs-section,
.hljs-selector-class {
  color: #a6e22e;
}

.hljs-strong {
  font-weight: bold;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-keyword,
.hljs-selector-tag,
.hljs-name,
.hljs-attr {
  color: #f92672;
}

.hljs-symbol,
.hljs-attribute {
  color: #66d9ef;
}

.hljs-params,
.hljs-class .hljs-title {
  color: #f8f8f2;
}

.hljs-string,
.hljs-type,
.hljs-built_in,
.hljs-builtin-name,
.hljs-selector-id,
.hljs-selector-attr,
.hljs-selector-pseudo,
.hljs-addition,
.hljs-variable,
.hljs-template-variable {
  color: #e6db74;
}

.hljs-comment,
.hljs-deletion,
.hljs-meta {
  color: #75715e;
}
</style><style>/*rgb(228, 172, 106);*/
:root{
  --bg:rgb(42, 42, 42);
  --main:rgb(254, 100, 216);
  --secondary:rgb(147, 220, 240);/*rgb(255, 131, 104);*/
  --highlight:rgb(252, 179, 211);
  --text:rgb(224, 220, 214);
}
body{
  font-family: Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
  margin:0 auto;
}
body::selection { color: var(--highlight) }
a{
  color:var(--highlight);
  transition:all 0.2s;
  font-family: 'Courier New', monospace;
}
a:hover{
  color:var(--highlight);
}
blockquote{
  border-left:3px solid var(--secondary);
  padding-left:1rem;
  color:var(--secondary);
}
img{
  max-width:100%;
}
small{
  color:var(--secondary);
}
h1{
  color:var(--text);
}
h1 a{
  text-decoration: none;
  color:var(--text);
}
h1,h2,h3,h4{
  color:var(--secondary);
  font-family: 'Courier New', monospace;
}
/* hr{
  border-color: var(--text);
  outline-color: var(--text);
} */
.header{
  background-image: url('/img/md-banner.jpg');
  background-size: cover;
  background-position: center;
  min-height:300px;
  padding:1rem;
}
.tagline{
  padding:1rem;
  display: block;
  text-align: right;
}
.archive-msg{
  background:red;
  color:var(--text);
  padding:1rem;
}
.nav{
  padding:1rem;
}
.nav a{
  text-decoration: none;
}
.ss-content{
  max-width:1000px;
  margin-left:10vw;
  padding:1rem;
}
@media only screen and (max-width: 1200px) {
  .ss-content{
    margin-left:0;
  }
}
.footer{
  padding:1rem;
}
/* GH Repo card override*/
.repo-card a{
  color:var(--highlight)!important;
}
</style><div class="ss-content"><script>const ssmeta=
{
  "title":"Traverse A Filesystem With Node",
  "description":"How to traverse through a local file system with NodeJS.",
  "tags":"#programming #js"
}
;</script>
<h1 id="traverseafilesystemwithnode">Traverse A Filesystem With Node</h1>
<h2 id="introduction">Introduction</h2>
<p>If you want to get a directory listing with NodeJS (similar to the Linux <code>ls</code> command) you can use something like <code>fs.readdirSync(path);</code>. This will synchronously read all files in the given <code>path</code> and return a list of files and directories as an array. </p>
<p>For example:</p>
<pre class="javascript language-javascript"><code class="hljs javascript language-javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);
<span class="hljs-keyword">const</span> listing = fs.readdirSync(__dirname);

<span class="hljs-built_in">console</span>.log(listing);
</code></pre>
<p>Might output something like:</p>
<pre class="javascript language-javascript"><code class="hljs javascript language-javascript">[ <span class="hljs-string">&#x27;index.js&#x27;</span>,
  <span class="hljs-string">&#x27;index.old.js&#x27;</span>,
  <span class="hljs-string">&#x27;index.test.js&#x27;</span>,
  <span class="hljs-string">&#x27;ld.js&#x27;</span>,
  <span class="hljs-string">&#x27;node_modules&#x27;</span>,
  <span class="hljs-string">&#x27;old&#x27;</span>,
  <span class="hljs-string">&#x27;package-lock.json&#x27;</span>,
  <span class="hljs-string">&#x27;package.json&#x27;</span>,
  <span class="hljs-string">&#x27;reduce.js&#x27;</span>,
  <span class="hljs-string">&#x27;source&#x27;</span>,
  <span class="hljs-string">&#x27;test.js&#x27;</span>,
  <span class="hljs-string">&#x27;testread.js&#x27;</span> ]
</code></pre>
<h2 id="goingdeeper">Going deeperâ€¦</h2>
<p>This is nice to know, but what if we also want to know what's in the <code>old</code> or <code>node_modules</code> directories?</p>
<p>We could run the same or similar code again on those directories, then if they contain more directories we repeat the processes. This works, but who knows how far down we have to go?</p>
<p>I think that the best way to solve a problem like this is using a recursive function. Something like what I have below:</p>
<pre class="javascript language-javascript"><code class="hljs javascript language-javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">traverse</span>(<span class="hljs-params">path, rootPath, list = []</span>)</span>{
  <span class="hljs-keyword">const</span> listing = fs.readdirSync(path);
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> item <span class="hljs-keyword">of</span> listing){
    <span class="hljs-keyword">const</span> itemPath = <span class="hljs-string">`<span class="hljs-subst">${path}</span>/<span class="hljs-subst">${item}</span>`</span>
    <span class="hljs-keyword">const</span> isDirectory = fs.lstatSync(itemPath).isDirectory();
    <span class="hljs-keyword">if</span>(isDirectory){
      list = traverse(itemPath,rootPath, list);
    }
    <span class="hljs-keyword">else</span>{
      list.push(itemPath.replace(<span class="hljs-string">`<span class="hljs-subst">${rootPath}</span>/`</span>, <span class="hljs-string">&#x27;&#x27;</span>));
    }
  }
  <span class="hljs-keyword">return</span> list;
}
</code></pre>
<p><strong>Note:</strong> <em>This code is far from perfect but I think it is readable and works for this example!</em></p>
<p>What this does is recursively traverse the file tree, creating a <code>list</code> array as it goes. When it sees a file it will add that files path to the <code>list</code> array. </p>
<hr />
<p>Here is a breakdown of the logic:</p>
<ul>
<li>Take in a <code>path</code> string which is the current path</li>
<li>Take in a <code>rootPath</code> string which is the original/root path</li>
<li>Take in a <code>list</code> array or create a blank <code>list</code> array</li>
<li>Get an array of the items in the current path as <code>listing</code></li>
<li>For each <code>item</code> of <code>listing</code>:</li>
<li>Create an <code>itemPath</code> constant that represents the full location of the item</li>
<li>Check if that path is a directory:<ul>
<li>True: </li>
<li>Traverse the new directory passing down the <code>list</code> array</li>
<li>Assign the results of the traversal to <code>list</code></li>
<li>False:</li>
<li>Add the <code>itemPath</code> to our list of files</li></ul></li>
<li>Return <code>list</code></li>
</ul>
<hr />
<p>So with the above function we could try something like:</p>
<pre class="javascript language-javascript"><code class="hljs javascript language-javascript"><span class="hljs-built_in">console</span>.log(traverse(__dirname, __dirname));
</code></pre>
<p>Which might output something like:</p>
<pre class="javascript language-javascript"><code class="hljs javascript language-javascript">[ <span class="hljs-string">&#x27;index.js&#x27;</span>,
  <span class="hljs-string">&#x27;index.old.js&#x27;</span>,
  <span class="hljs-string">&#x27;index.test.js&#x27;</span>,
  <span class="hljs-string">&#x27;ld.js&#x27;</span>,
  <span class="hljs-string">&#x27;node_modules/lodash/add.js&#x27;</span>,
  <span class="hljs-string">&#x27;node_modules/lodash/after.js&#x27;</span>,
  <span class="hljs-string">&#x27;node_modules/lodash/array.js&#x27;</span>,
  <span class="hljs-string">&#x27;node_modules/lodash/ary.js&#x27;</span>,
  <span class="hljs-string">&#x27;node_modules/lodash/assign.js&#x27;</span>,
  <span class="hljs-string">&#x27;node_modules/lodash/assignIn.js&#x27;</span>,
  <span class="hljs-string">&#x27;node_modules/lodash/assignInWith.js&#x27;</span>,
  ...,
]
</code></pre>
<h2 id="theeasyway">The easy way</h2>
<p>If you find yourself needing to do something like this in any sort of advanced or truly reliable manner I would suggest looking into the NPM package <a href="https://www.npmjs.com/package/directory-tree">directory-tree</a>. This package will do a lot more than get you a flat list of the files. </p></div><br><br><br>
<hr>
<div class="footer">
  <div>
    &copy; Mathieu Dombrock 2023 | <a href="mailto:dombrock.mathieu@gmail.com">dombrock.mathieu@gmail.com</a> | 
    <a href="https://github.com/matdombrock" target="_blank">Github</a> | 
    <a href="https://github.com/matdombrock/SteelSky" target="_blank">SteelSky</a> |
    <small id="visits"></small>
  </div>
  <div>
    <small style="text-align:right;">
    </small>
  </div>

  <script>
    let visits = localStorage.getItem('visits');
    if(visits === undefined){
      visits = 0;
    }
    visits++;
    localStorage.setItem('visits', visits);
    document.getElementById('visits').innerHTML = "This browser has been here " + visits + " times";
  </script>
</div>